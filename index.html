<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»°</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="score-board">
        <p>ğŸ’° ÄIá»‚M Cá»¦A Báº N: <strong id="playerCoins">0</strong></p>
    </div>

    <div class="header">
        <h1>ğŸ® MINI GAME ÄÆ¯á»¢C Táº O Bá»I NGUYá»„N CHÃ Dá»° ğŸ‰</h1>
        <div class="subtitle">ğŸ¥³ CHÃšC CÃC Báº N CHÆ I MINI GAME VUI Váºº ğŸ¥³</div>
    </div>

    <p class="intro-text">CHá»ŒN Má»˜T MINI GAME Äá»‚ CHÆ I NÃ€O! ğŸš€</p>

    <div class="menu">
        <button onclick="showGame('snake')">ğŸ Ráº®N SÄ‚N Má»’I</button>
        <button onclick="showGame('tictactoe')">â­• Ã” Ä‚N QUAN (Cá»œ CARO)</button>
        <button onclick="showGame('flappy')">ğŸ¦ FLAPPY BIRD</button>
        <button onclick="showGame('pikachu')">ğŸ€„ PIKACHU GHÃ‰P Cáº¶P</button>
        <button onclick="showGame('shop')">ğŸ›’ SHOP MUA ITEM</button>
        <button class="info-btn" onclick="showInfo()">â„¹ï¸ THÃ”NG TIN & UPDATE</button>
    </div>

    <!-- Ráº®N SÄ‚N Má»’I -->
    <div id="snake" class="game-container">
        <h2>ğŸ Ráº®N SÄ‚N Má»’I</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM MÅ¨I TÃŠN â†‘ â† â†“ â†’</p>
            <p>ğŸ“± MOBILE: NÃšT ÄIá»€U HÆ¯á»šNG DÆ¯á»šI MÃ€N HÃŒNH</p>
        </div>
        <canvas id="snakeCanvas" width="400" height="400"></canvas>
        <div id="snakeScore" class="score">ÄIá»‚M HIá»†N Táº I: 0</div>
        <div id="snakeControls" class="mobile-controls">
            <button onclick="changeDirection('up')">â†‘</button>
            <div class="horizontal-controls">
                <button onclick="changeDirection('left')">â†</button>
                <button onclick="changeDirection('down')">â†“</button>
                <button onclick="changeDirection('right')">â†’</button>
            </div>
        </div>
    </div>

    <!-- Ã” Ä‚N QUAN (Cá»œ CARO) -->
    <div id="tictactoe" class="game-container">
        <h2>â­• Ã” Ä‚N QUAN (Cá»œ CARO)</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ğŸ“± CLICK/CHáº M VÃ€O Ã” TRá»NG Äá»‚ Äáº¶T X (Báº N LÃ€ X, MÃY LÃ€ O)</p>
        </div>
        <table class="ttt-table">
            <tr>
                <td onclick="playTTT(0)"><h1 id="ttt0">&nbsp;</h1></td>
                <td onclick="playTTT(1)"><h1 id="ttt1">&nbsp;</h1></td>
                <td onclick="playTTT(2)"><h1 id="ttt2">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(3)"><h1 id="ttt3">&nbsp;</h1></td>
                <td onclick="playTTT(4)"><h1 id="ttt4">&nbsp;</h1></td>
                <td onclick="playTTT(5)"><h1 id="ttt5">&nbsp;</h1></td>
            </tr>
            <tr>
                <td onclick="playTTT(6)"><h1 id="ttt6">&nbsp;</h1></td>
                <td onclick="playTTT(7)"><h1 id="ttt7">&nbsp;</h1></td>
                <td onclick="playTTT(8)"><h1 id="ttt8">&nbsp;</h1></td>
            </tr>
        </table>
        <p id="tttStatus" class="status"></p>
    </div>

    <!-- FLAPPY BIRD (ÄÃƒ Sá»¬A THEO YÃŠU Cáº¦U) -->
    <div id="flappy" class="game-container">
        <h2>ğŸ¦ FLAPPY BIRD</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ PC/MAC: PHÃM SPACE HOáº¶C CLICK CHUá»˜T</p>
            <p>ğŸ“± MOBILE: CHáº M MÃ€N HÃŒNH Äá»‚ BAY LÃŠN</p>
        </div>
        <div class="game-controls">
            <button onclick="pauseFlappy()">â¸ Táº M Dá»ªNG</button>
            <button onclick="confirmRestart()">ğŸ”„ CHÆ I Láº I (RESET ÄIá»‚M)</button>
            <button onclick="confirmQuit()">ğŸ  TRá» Vá»€ MENU (-10 ÄIá»‚M)</button>
        </div>
        <canvas id="flappyCanvas" width="400" height="500"></canvas>
        <div id="flappyScore" class="score">ÄIá»‚M HIá»†N Táº I: 0 / 100</div>
    </div>

    <!-- PIKACHU GHÃ‰P Cáº¶P -->
    <div id="pikachu" class="game-container">
        <h2>ğŸ€„ PIKACHU GHÃ‰P Cáº¶P</h2>
        <div class="controls-guide">
            <p><strong>ÄIá»€U KHIá»‚N:</strong></p>
            <p>ğŸ–¥ï¸ğŸ“± CLICK/CHáº M VÃ€O 2 Ã” GIá»NG NHAU Äá»‚ GHÃ‰P</p>
            <p>GHÃ‰P Háº¾T Äá»‚ THáº®NG!</p>
        </div>
        <div id="pikachuBoard"></div>
        <p id="pikachuStatus" class="status">CÃ’N Láº I: <span id="pairsLeft">8</span> Cáº¶P</p>
    </div>

    <!-- SHOP -->
    <div id="shop" class="game-container">
        <h2>ğŸ›’ SHOP MUA ITEM</h2>
        <p>DÃ™NG ÄIá»‚M KIáº¾M ÄÆ¯á»¢C Äá»‚ MUA SKIN VÃ€ HIá»†U á»¨NG Äáº¸P HÆ N!</p>
        <div class="shop-info">
            <p>ğŸ’° ÄIá»‚M HIá»†N Táº I: <strong id="playerCoins">0</strong></p>
        </div>
        <div class="shop-items">
            <div class="shop-item">
                <span>ğŸ¨ SKIN Ráº®N XANH LÃ (Máº¶C Äá»ŠNH)</span>
                <button disabled>ÄÃƒ Sá» Há»®U</button>
            </div>
            <div class="shop-item">
                <span>ğŸ”¥ SKIN Ráº®N Lá»¬A Äá» (200 ÄIá»‚M)</span>
                <button id="buy-redSnake" onclick="buyItem('redSnake', 200)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸŒˆ SKIN Ráº®N Cáº¦U Vá»’NG (500 ÄIá»‚M)</span>
                <button id="buy-rainbowSnake" onclick="buyItem('rainbowSnake', 500)">MUA</button>
            </div>
            <div class="shop-item">
                <span>ğŸ¦¸ SKIN CHIM SIÃŠU ANH HÃ™NG (300 ÄIá»‚M)</span>
                <button id="buy-heroBird" onclick="buyItem('heroBird', 300)">MUA</button>
            </div>
            <div class="shop-item">
                <span>âœ¨ HIá»†U á»¨NG GHÃ‰P ÄÃ”I Láº¤P LÃNH (400 ÄIá»‚M)</span>
                <button id="buy-sparkleMatch" onclick="buyItem('sparkleMatch', 400)">MUA</button>
            </div>
        </div>
    </div>

    <!-- MODAL GAME OVER / THáº®NG -->
    <div id="gameModal" class="modal">
        <div class="modal-content">
            <div id="fireworks" class="fireworks"></div>
            <div id="rain" class="rain"></div>
            <h2 id="modalTitle">ğŸ‰ CHÃšC Má»ªNG!</h2>
            <p id="modalMessage">Báº N ÄÃƒ THáº®NG Vá»šI ÄIá»‚M Sá» TUYá»†T Vá»œI!</p>
            <button class="restart-btn" onclick="restartCurrentGame()">ğŸ”„ CHÆ I Láº I</button>
        </div>
    </div>

    <!-- MODAL THÃ”NG TIN -->
    <div id="infoModal" class="modal">
        <div class="modal-content info-modal">
            <h2>â„¹ï¸ THÃ”NG TIN & UPDATE</h2>
            <div class="info-content">
                <p><strong>TÃC GIáº¢:</strong> NGUYá»„N CHÃ Dá»°</p>
                <p><strong>PHIÃŠN Báº¢N:</strong> 3.0</p>
                <p><strong>Cáº¬P NHáº¬T Má»šI:</strong></p>
                <ul>
                    <li>FLAPPY BIRD Cáº¦N 100 ÄIá»‚M Äá»‚ WIN + HIá»†U á»¨NG PHÃO HOA / MÆ¯A</li>
                    <li>NÃšT Táº M Dá»ªNG, CHÆ I Láº I, TRá» Vá»€ MENU Vá»šI XÃC NHáº¬N</li>
                    <li>NÃšT REPORT BUGS & Gá»¢I Ã TRÃ’ CHÆ I</li>
                    <li>Báº¢NG ÄIá»‚M CHUNG + HÆ¯á»šNG DáºªN ÄIá»€U KHIá»‚N RÃ• RÃ€NG</li>
                    <li>FOOTER MADE IN VN</li>
                </ul>
                <p><strong>Lá»œI NHáº®N:</strong> CHÃšC CÃC Báº N CHÆ I VUI! â¤ï¸</p>
            </div>
            <button class="restart-btn" onclick="closeInfo()">ÄÃ“NG</button>
        </div>
    </div>

    <!-- MODAL REPORT BUGS -->
    <div id="bugModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ› REPORT BUGS</h2>
            <p>Gá»¬I Lá»–I Báº N Gáº¶P PHáº¢I Äá»‚ MÃŒNH Sá»¬A NHÃ‰!</p>
            <input type="email" id="bugEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="bugMessage" placeholder="MÃ” Táº¢ Lá»–I CHI TIáº¾T" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendBugReport()">Gá»¬I REPORT</button>
            <button class="restart-btn" onclick="closeBugModal()">ÄÃ“NG</button>
        </div>
    </div>

    <!-- MODAL Gá»¢I Ã TRÃ’ CHÆ I -->
    <div id="suggestModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</h2>
            <p>Gá»¢I Ã TRÃ’ CHÆ I Má»šI Báº N MUá»N THÃŠM NHÃ‰!</p>
            <input type="email" id="suggestEmail" placeholder="GMAIL Cá»¦A Báº N (Báº®T BUá»˜C)" required>
            <textarea id="suggestMessage" placeholder="TÃŠN TRÃ’ CHÆ I HOáº¶C MÃ” Táº¢" required></textarea>
            <p>GMAIL Há»– TRá»¢: <strong>Herogoodboymc2024@gmail.com</strong></p>
            <button class="restart-btn" onclick="sendSuggest()">Gá»¬I Gá»¢I Ã</button>
            <button class="restart-btn" onclick="closeSuggestModal()">ÄÃ“NG</button>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <p>MADE IN VN ğŸ‡»ğŸ‡³</p>
        <p>MADE BY: NGUYá»„N CHÃ Dá»° â™¥ï¸ğŸ‡»ğŸ‡³</p>
        <div class="extra-buttons">
            <button onclick="showBugModal()">ğŸ› REPORT BUGS</button>
            <button onclick="showSuggestModal()">ğŸ’¡ Gá»¢I Ã TRÃ’ CHÆ I</button>
        </div>
    </div>

    <!-- Ã‚M THANH -->
    <audio id="eatSound" preload="auto" src="https://www.myinstants.com/media/sounds/coin-mario.mp3"></audio>
    <audio id="jumpSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-jump.mp3"></audio>
    <audio id="matchSound" preload="auto" src="https://www.myinstants.com/media/sounds/success-chime-49738.mp3"></audio>
    <audio id="gameOverSound" preload="auto" src="https://www.myinstants.com/media/sounds/mario-bros-game-over.mp3"></audio>
    <audio id="victorySound" preload="auto" src="https://www.myinstants.com/media/sounds/final-fantasy-victory-fanfare.mp3"></audio>

    <script>
        let currentGame = '';
        let playerCoins = parseInt(localStorage.getItem('playerCoins')) || 0;
        let ownedItems = JSON.parse(localStorage.getItem('ownedItems')) || ['defaultSnake'];

        let flappyPaused = false;
        let flappyAnimationId = null;

        window.onload = () => {
            document.getElementById('playerCoins').innerText = playerCoins;
            updateShopButtons();
            adjustCanvasSize();
            showGame('snake');
        };

        function showGame(gameId) {
            document.querySelectorAll('.game-container').forEach(div => div.style.display = 'none');
            document.getElementById(gameId).style.display = 'block';
            currentGame = gameId;
            if (gameId === 'snake') initSnake();
            if (gameId === 'flappy') initFlappy();
            if (gameId === 'pikachu') initPikachu();
            if (gameId === 'tictactoe') resetTTT();
            if (gameId === 'shop') updateShopButtons();
            closeAllModals();
            adjustCanvasSize();
        }

        function closeAllModals() {
            document.getElementById('gameModal').style.display = 'none';
            document.getElementById('infoModal').style.display = 'none';
            document.getElementById('bugModal').style.display = 'none';
            document.getElementById('suggestModal').style.display = 'none';
            document.getElementById('fireworks').innerHTML = '';
            document.getElementById('rain').innerHTML = '';
        }

        function updateShopButtons() {
            const buttons = {
                'redSnake': 'buy-redSnake',
                'rainbowSnake': 'buy-rainbowSnake',
                'heroBird': 'buy-heroBird',
                'sparkleMatch': 'buy-sparkleMatch'
            };
            Object.keys(buttons).forEach(item => {
                const btn = document.getElementById(buttons[item]);
                if (btn) {
                    if (ownedItems.includes(item)) {
                        btn.innerText = 'ÄÃƒ Sá» Há»®U';
                        btn.disabled = true;
                    } else {
                        btn.innerText = 'MUA';
                        btn.disabled = false;
                    }
                }
            });
        }

        function buyItem(item, cost) {
            if (playerCoins >= cost && !ownedItems.includes(item)) {
                playerCoins -= cost;
                ownedItems.push(item);
                localStorage.setItem('playerCoins', playerCoins);
                localStorage.setItem('ownedItems', JSON.stringify(ownedItems));
                document.getElementById('playerCoins').innerText = playerCoins;
                alert('ğŸ‰ MUA THÃ€NH CÃ”NG! ITEM ÄÃƒ ÄÆ¯á»¢C THÃŠM VÃ€O KHO.');
                updateShopButtons();
            } else if (ownedItems.includes(item)) {
                alert('Báº N ÄÃƒ Sá» Há»®U ITEM NÃ€Y Rá»’I!');
            } else {
                alert('KHÃ”NG Äá»¦ ÄIá»‚M Äá»‚ MUA!');
            }
        }

        function showInfo() {
            document.getElementById('infoModal').style.display = 'flex';
        }

        function closeInfo() {
            document.getElementById('infoModal').style.display = 'none';
        }

        function showBugModal() {
            document.getElementById('bugModal').style.display = 'flex';
        }

        function closeBugModal() {
            document.getElementById('bugModal').style.display = 'none';
        }

        function sendBugReport() {
            const email = document.getElementById('bugEmail').value.trim();
            const message = document.getElementById('bugMessage').value.trim();
            if (email && message) {
                alert('Cáº¢M Æ N Báº N ÄÃƒ REPORT BUG! MÃŒNH Sáº¼ Sá»¬A Sá»šM NHáº¤T â¤ï¸');
                document.getElementById('bugEmail').value = '';
                document.getElementById('bugMessage').value = '';
                closeBugModal();
            } else {
                alert('VUI LÃ’NG NHáº¬P Äáº¦Y Äá»¦ GMAIL VÃ€ TIN NHáº®N!');
            }
        }

        function showSuggestModal() {
            document.getElementById('suggestModal').style.display = 'flex';
        }

        function closeSuggestModal() {
            document.getElementById('suggestModal').style.display = 'none';
        }

        function sendSuggest() {
            const email = document.getElementById('suggestEmail').value.trim();
            const message = document.getElementById('suggestMessage').value.trim();
            if (email && message) {
                alert('Cáº¢M Æ N Gá»¢I Ã Cá»¦A Báº N! MÃŒNH Sáº¼ XEM XÃ‰T THÃŠM TRÃ’ Má»šI â¤ï¸');
                document.getElementById('suggestEmail').value = '';
                document.getElementById('suggestMessage').value = '';
                closeSuggestModal();
            } else {
                alert('VUI LÃ’NG NHáº¬P Äáº¦Y Äá»¦ GMAIL VÃ€ Gá»¢I Ã!');
            }
        }

        function showModal(title, message, isVictory = false) {
            document.getElementById('modalTitle').innerHTML = title;
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('fireworks').innerHTML = isVictory ? '' : '';
            document.getElementById('rain').innerHTML = isVictory ? '' : '';
            if (isVictory) {
                createFireworks();
            } else {
                createRain();
            }
            playSound(isVictory ? 'victorySound' : 'gameOverSound');
        }

        function createFireworks() {
            const fireworks = document.getElementById('fireworks');
            for (let i = 0; i < 30; i++) {
                const fw = document.createElement('div');
                fw.className = 'firework';
                fw.style.left = Math.random() * 100 + '%';
                fw.style.top = Math.random() * 100 + '%';
                fw.style.animationDelay = Math.random() * 1 + 's';
                fireworks.appendChild(fw);
            }
        }

        function createRain() {
            const rain = document.getElementById('rain');
            for (let i = 0; i < 50; i++) {
                const drop = document.createElement('div');
                drop.className = 'rain-drop';
                drop.style.left = Math.random() * 100 + '%';
                drop.style.animationDelay = Math.random() * 2 + 's';
                drop.style.animationDuration = 1 + Math.random() * 1 + 's';
                rain.appendChild(drop);
            }
        }

        function restartCurrentGame() {
            document.getElementById('gameModal').style.display = 'none';
            showGame(currentGame);
        }

        function confirmRestart() {
            if (confirm('Báº N Äá»’NG Ã CHÆ I Láº I? ÄIá»‚M Sáº¼ RESET Vá»€ 0!')) {
                restartCurrentGame();
            }
        }

        function confirmQuit() {
            if (confirm('Báº N Äá»’NG Ã TRá» Vá»€ MENU? Sáº¼ Bá»Š TRá»ª 10 ÄIá»‚M!')) {
                playerCoins = Math.max(0, playerCoins - 10);
                localStorage.setItem('playerCoins', playerCoins);
                document.getElementById('playerCoins').innerText = playerCoins;
                showGame('snake');
            }
        }

        function pauseFlappy() {
            flappyPaused = !flappyPaused;
            if (flappyPaused) {
                cancelAnimationFrame(flappyAnimationId);
            } else {
                requestAnimationFrame(updateFlappy);
            }
        }

        function playSound(id) {
            const sound = document.getElementById(id);
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            }
        }

        function addCoins(amount) {
            playerCoins += amount;
            localStorage.setItem('playerCoins', playerCoins);
            document.getElementById('playerCoins').innerText = playerCoins;
        }

        function adjustCanvasSize() {
            const canvases = document.querySelectorAll('canvas');
            canvases.forEach(canvas => {
                const maxWidth = Math.min(window.innerWidth - 40, 400);
                const ratio = canvas.height / canvas.width;
                canvas.style.width = `${maxWidth}px`;
                canvas.style.height = `${maxWidth * ratio}px`;
            });
        }
        window.addEventListener('resize', adjustCanvasSize);

        // Ráº®N SÄ‚N Má»’I (GIá»® NGUYÃŠN)
        let snakeCanvas, snakeCtx, snakeScore = 0;
        let snake = [{x: 200, y: 200}];
        let dx = 10, dy = 0;
        let foodX, foodY;
        let lastFrameTime = 0;
        let frameInterval = 100;
        let pendingDirection = null;

        function initSnake() {
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            snakeScore = 0;
            document.getElementById('snakeScore').innerText = 'ÄIá»‚M HIá»†N Táº I: 0';
            snake = [{x: 200, y: 200}];
            dx = 10; dy = 0;
            pendingDirection = null;
            createFood();
            lastFrameTime = performance.now();
            requestAnimationFrame(updateSnake);
        }

        function createFood() {
            foodX = Math.floor(Math.random() * 40) * 10;
            foodY = Math.floor(Math.random() * 40) * 10;
        }

        function updateSnake(currentTime) {
            if (currentTime - lastFrameTime > frameInterval) {
                lastFrameTime = currentTime;

                if (pendingDirection) {
                    switch (pendingDirection) {
                        case 'up': if (dy === 0) { dx = 0; dy = -10; } break;
                        case 'down': if (dy === 0) { dx = 0; dy = 10; } break;
                        case 'left': if (dx === 0) { dx = -10; dy = 0; } break;
                        case 'right': if (dx === 0) { dx = 10; dy = 0; } break;
                    }
                    pendingDirection = null;
                }

                snakeCtx.clearRect(0, 0, snakeCanvas.width, snakeCanvas.height);

                let snakeColor = ownedItems.includes('redSnake') ? '#e74c3c' : '#4CAF50';
                snake.forEach(part => {
                    snakeCtx.fillStyle = snakeColor;
                    snakeCtx.fillRect(part.x, part.y, 10, 10);
                    snakeCtx.strokeStyle = '#388E3C';
                    snakeCtx.strokeRect(part.x, part.y, 10, 10);
                });

                snakeCtx.fillStyle = '#FF5722';
                snakeCtx.fillRect(foodX, foodY, 10, 10);

                let head = {x: snake[0].x + dx, y: snake[0].y + dy};

                if (head.x < 0 || head.x >= snakeCanvas.width || head.y < 0 || head.y >= snakeCanvas.height || snake.slice(1).some(part => part.x === head.x && part.y === head.y)) {
                    addCoins(snakeScore);
                    showModal('ğŸ’” GAME OVER!', `Báº N Äáº T <strong>\( {snakeScore}</strong> ÄIá»‚M!<br>+ \){snakeScore} ğŸ’° VÃ€O VÃ!`, false);
                    return;
                }

                snake.unshift(head);

                if (head.x === foodX && head.y === foodY) {
                    snakeScore++;
                    document.getElementById('snakeScore').innerText = 'ÄIá»‚M HIá»†N Táº I: ' + snakeScore;
                    createFood();
                    playSound('eatSound');
                } else {
                    snake.pop();
                }
            }
            requestAnimationFrame(updateSnake);
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') pendingDirection = 'up';
            if (e.key === 'ArrowDown') pendingDirection = 'down';
            if (e.key === 'ArrowLeft') pendingDirection = 'left';
            if (e.key === 'ArrowRight') pendingDirection = 'right';
        });

        function changeDirection(dir) {
            pendingDirection = dir;
        }

        // Cá»œ CARO (GIá»® NGUYÃŠN)
        let tttBoard = Array(9).fill(null);

        function playTTT(index) {
            if (tttBoard[index] || checkWinner(tttBoard)) return;
            tttBoard[index] = 'X';
            document.getElementById('ttt' + index).innerText = 'X';
            if (checkWinner(tttBoard)) {
                addCoins(50);
                showModal('ğŸ‰ CHÃšC Má»ªNG!', 'Báº N THáº®NG Cá»œ CARO!<br>+50 ğŸ’° THÆ¯á»NG!', true);
                return;
            }
            if (tttBoard.every(cell => cell)) {
                addCoins(10);
                showModal('ğŸ¤ HÃ’A NHAU!', 'HÃ’A VÃN NÃ€Y!<br>+10 ğŸ’° AN á»¦I', false);
                return;
            }
            setTimeout(computerMove, 500);
        }

        function computerMove() {
            let bestMove = -1;
            for (let i = 0; i < 9; i++) {
                if (!tttBoard[i]) {
                    tttBoard[i] = 'X';
                    if (checkWinner(tttBoard)) { bestMove = i; tttBoard[i] = null; break; }
                    tttBoard[i] = null;
                }
            }
            if (bestMove === -1) {
                for (let i = 0; i < 9; i++) {
                    if (!tttBoard[i]) {
                        tttBoard[i] = 'O';
                        if (checkWinner(tttBoard)) { bestMove = i; tttBoard[i] = null; break; }
                        tttBoard[i] = null;
                    }
                }
            }
            if (bestMove === -1) {
                let available = tttBoard.map((v, i) => v === null ? i : null).filter(v => v !== null);
                bestMove = available[Math.floor(Math.random() * available.length)];
            }
            tttBoard[bestMove] = 'O';
            document.getElementById('ttt' + bestMove).innerText = 'O';
            if (checkWinner(tttBoard)) {
                addCoins(5);
                showModal('ğŸ¤– MÃY THáº®NG!', 'MÃY THáº®NG Rá»’I!<br>+5 ğŸ’° AN á»¦I', false);
            } else if (tttBoard.every(cell => cell)) {
                addCoins(10);
                showModal('ğŸ¤ HÃ’A NHAU!', 'Láº I HÃ’A!<br>+10 ğŸ’°', false);
            }
        }

        function checkWinner(board) {
            const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
            return wins.some(combo => combo.every(i => board[i] === board[combo[0]] && board[i]));
        }

        function resetTTT() {
            tttBoard = Array(9).fill(null);
            for (let i = 0; i < 9; i++) document.getElementById('ttt' + i).innerText = ' ';
            document.getElementById('tttStatus').innerText = '';
        }

        // FLAPPY BIRD (ÄÃƒ Sá»¬A: CHIM NHá» HÆ N, HITBOX NHá», 100 ÄIá»‚M WIN, NÃšT ÄIá»€U KHIá»‚N)
        let flappyCanvas, flappyCtx, birdY = 250, birdVelocity = 0, pipes = [], flappyScore = 0;
        let gravity = 0.5, jump = -10;

        function initFlappy() {
            flappyCanvas = document.getElementById('flappyCanvas');
            flappyCtx = flappyCanvas.getContext('2d');
            birdY = 250; birdVelocity = 0; pipes = []; flappyScore = 0;
            flappyPaused = false;
            document.getElementById('flappyScore').innerText = 'ÄIá»‚M HIá»†N Táº I: 0 / 100';
            pipes.push({x: 400, gap: Math.random() * 150 + 100});
            flappyAnimationId = requestAnimationFrame(updateFlappy);
        }

        function updateFlappy() {
            if (flappyPaused) return;

            flappyCtx.clearRect(0, 0, flappyCanvas.width, flappyCanvas.height);
            birdVelocity += gravity;
            birdY += birdVelocity;

            if (birdY > flappyCanvas.height - 20 || birdY < 0) { // Chim nhá» hÆ¡n
                addCoins(Math.floor(flappyScore / 2));
                showModal('ğŸ’¥ VA CHáº M!', `Báº N Äáº T <strong>\( {flappyScore}</strong> ÄIá»‚M!<br>+ \){Math.floor(flappyScore / 2)} ğŸ’°`, false);
                return;
            }

            flappyCtx.fillStyle = ownedItems.includes('heroBird') ? '#e74c3c' : '#FFEB3B';
            flappyCtx.fillRect(50, birdY, 30, 20); // Chim nhá» hÆ¡n (30x20 thay vÃ¬ 40x30)
            flappyCtx.fillStyle = '#000';
            flappyCtx.fillRect(75, birdY + 5, 10, 8); // Máº¯t nhá» hÆ¡n

            pipes.forEach(pipe => {
                pipe.x -= 2;
                flappyCtx.fillStyle = '#4CAF50';
                flappyCtx.fillRect(pipe.x, 0, 50, pipe.gap);
                flappyCtx.fillRect(pipe.x, pipe.gap + 150, 50, flappyCanvas.height - pipe.gap - 150);

                if (pipe.x + 50 === 80) { // Hitbox nhá» hÆ¡n
                    flappyScore++;
                    document.getElementById('flappyScore').innerText = 'ÄIá»‚M HIá»†N Táº I: ' + flappyScore + ' / 100';
                    playSound('eatSound');
                    if (flappyScore >= 100) {
                        addCoins(200);
                        showModal('ğŸ‰ CHÃšC Má»ªNG WIN!', 'Báº N ÄÃƒ Äáº T 100 ÄIá»‚M!<br>+200 ğŸ’° THÆ¯á»NG Lá»šN!', true);
                        return;
                    }
                }

                if (pipe.x < 80 && pipe.x > 20 && (birdY < pipe.gap || birdY + 20 > pipe.gap + 150)) {
                    addCoins(Math.floor(flappyScore / 2));
                    showModal('ğŸ’¥ GAME OVER!', `ÄIá»‚M CAO: <strong>\( {flappyScore}</strong><br>+ \){Math.floor(flappyScore / 2)} ğŸ’°`, false);
                    return;
                }
            });

            if (pipes[pipes.length-1].x < 200) pipes.push({x: 400, gap: Math.random() * 150 + 100});
            if (pipes[0].x < -50) pipes.shift();

            flappyAnimationId = requestAnimationFrame(updateFlappy);
        }

        document.addEventListener('keydown', e => { if (e.key === ' ') { birdVelocity = jump; playSound('jumpSound'); } });
        flappyCanvas.addEventListener('touchstart', e => { e.preventDefault(); birdVelocity = jump; playSound('jumpSound'); });

        // PIKACHU (GIá»® NGUYÃŠN)
        const emojis = ['ğŸ¶','ğŸ±','ğŸ­','ğŸ¹','ğŸ°','ğŸ¦Š','ğŸ»','ğŸ¼'];
        let pikachuCards = [...emojis, ...emojis];
        let selected = [];

        function initPikachu() {
            pikachuCards.sort(() => Math.random() - 0.5);
            const board = document.getElementById('pikachuBoard');
            board.innerHTML = '';
            pikachuCards.forEach((emoji, i) => {
                const card = document.createElement('div');
                card.className = 'pikachu-card';
                card.onclick = () => flipCard(card, emoji);
                card.ontouchstart = () => flipCard(card, emoji);
                board.appendChild(card);
            });
            document.getElementById('pairsLeft').innerText = '8';
        }

        function flipCard(card, emoji) {
            if (card.innerText || selected.length === 2) return;
            card.innerText = emoji;
            card.style.background = '#fff';
            selected.push({card, emoji});
            if (selected.length === 2) {
                if (selected[0].emoji === selected[1].emoji) {
                    let matchBg = ownedItems.includes('sparkleMatch') ? 'linear-gradient(135deg, #ff9a9e, #fad0c4)' : '#a8e6cf';
                    selected[0].card.style.background = matchBg;
                    selected[1].card.style.background = matchBg;
                    selected[0].card.style.cursor = 'default';
                    selected[1].card.style.cursor = 'default';
                    playSound('matchSound');
                    let pairs = parseInt(document.getElementById('pairsLeft').innerText) - 1;
                    document.getElementById('pairsLeft').innerText = pairs;
                    if (pairs === 0) {
                        addCoins(100);
                        showModal('ğŸ‰ TUYá»†T Vá»œI!', 'Báº N ÄÃƒ GHÃ‰P Háº¾T!<br>+100 ğŸ’° THÆ¯á»NG Lá»šN!', true);
                    }
                } else {
                    setTimeout(() => {
                        selected[0].card.innerText = '';
                        selected[1].card.innerText = '';
                        selected[0].card.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                        selected[1].card.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    }, 800);
                }
                selected = [];
            }
        }
    </script>
</body>
</html>
